@ECHO OFF

REM #### VARS SETUP

SET "WINSDKKITVERSION=10"
SET "WINSDKVERSION=10.0.17763.0"

IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" (
	SET "WINSDKPATH=%ProgramFiles(x86)%\Windows Kits\%WINSDKKITVERSION%"
) ELSE (
	SET "WINSDKPATH=%ProgramFiles%\Windows Kits\%WINSDKKITVERSION%"
)

IF "%VS2019INSTALLDIR%" NEQ "" (
	SET "VCINSTALLDIR=%VS2019INSTALLDIR%"
) ELSE (
	SET "VCINSTALLDIR=%VS2017INSTALLDIR%"
)

FOR /F "delims=" %%A IN ('type "%VCINSTALLDIR%\VC\Auxiliary\Build\Microsoft.VCToolsVersion.default.txt"') DO SET "VCTOOLSVERSION=%%A"
SET "VCTOOLSPATH=%VCINSTALLDIR%\VC\Tools\MSVC\%VCTOOLSVERSION%"
SET "VCTOOLSBINPATH=%VCTOOLSPATH%\bin\Hostx64"

SET "PATH=%PATH%;"
SET "WINDBG=%WINSDKPATH%\Debuggers\"

REM #### COMPILER

SET "PATH=%PATH%%VCTOOLSBINPATH%\x64;"

IF "%PROCESSOR_ARCHITECTURE%" == "AMD64" (
	SET "PATH=%PATH%%ICPP_COMPILER19%bin\intel64_ia32;"
) ELSE (
	SET "PATH=%PATH%%ICPP_COMPILER19%bin\ia32;"
)

SET "PATH=%PATH%%WINSDKPATH%\bin\%WINSDKVERSION%\x64;"

REM #### INCLUDE AND LIBS

SET "PATH=%PATH%%WINSDKPATH%\bin\%WINSDKVERSION%\x64;"
SET "PATH=%PATH%%WINSDKPATH%\Tools\x64;"

SET "INCLUDE=%INCLUDE%%WINSDKPATH%\Include\%WINSDKVERSION%\ucrt;"
SET "INCLUDE=%INCLUDE%%WINSDKPATH%\Include\%WINSDKVERSION%\shared;"
SET "INCLUDE=%INCLUDE%%WINSDKPATH%\Include\%WINSDKVERSION%\um;"
SET "INCLUDE=%INCLUDE%%WINSDKPATH%\Include\%WINSDKVERSION%\km;"
SET "INCLUDE=%INCLUDE%%VCTOOLSPATH%\include;"

SET "LIB=%LIB%%WINSDKPATH%\Lib\%WINSDKVERSION%\um\x86;"
SET "LIB=%LIB%%WINSDKPATH%\Lib\%WINSDKVERSION%\ucrt\x86;"
SET "LIB=%LIB%%WINSDKPATH%\Lib\%WINSDKVERSION%\km\x86;"
SET "LIB=%LIB%%VCTOOLSPATH%\lib\x86;"
SET "LIB=%LIB%%ICPP_COMPILER19%compiler\lib\ia32_win;"

REM #### Utils

SET "PATH=%PATH%%WINSDKPATH%\Tools\x86;"
SET "PATH=%PATH%%cd%\tools;"
SET "PATH=%PATH%%__GNU_MAKE%;"

SET "PROJECT_PATH=%cd%"
SET "PROJECT_BIN_PATH=%PROJECT_PATH%\bin"
SET "PROJECT_INCLUDE_PATH=%PROJECT_PATH%\source\include"

IF "%1%" NEQ "" (
	"tools\setbuild.bat" %1%
)

(
	TITLE Master 0.1
)

:END

